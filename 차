#include <iostream>
#include <string>
#include <iomanip>
#include <map>
#include <cmath>
#include <algorithm>
#include <limits>
#include <sstream>
#include <stdexcept>

using namespace std;

// ì°¨ëŸ‰ ì •ë³´ êµ¬ì¡°ì²´
struct CarInfo {
    string name;
    double tankCapacity;       // ìœ ë¥˜íƒ±í¬ ìš©ëŸ‰ (ë¦¬í„°)
    double fuelEfficiency;    // ë¦¬í„°ë‹¹ ì—°ë¹„ (km/L)
};

// <ìœ ì¢…, ê°€ê²©> ë§µì˜ ë³„ì¹­
using FuelPriceMap = map<string, double>;

// **ìƒˆë¡œ ì¶”ê°€ëœ ë°ì´í„°: ì´ë¯¸ì§€ íŒŒì¼ì˜ 2025ë…„ 12ì›” 1ì¼ ~ 7ì¼ ì¼ë³„ í‰ê·  ê°€ê²©**
// í‚¤: "YYMMDD" (ë¬¸ìì—´), ê°’: <ìœ ì¢…, ê°€ê²©> ë§µ
map<string, FuelPriceMap> dailyFuelPrices = {
    {"251201", {{"ê³ ê¸‰íœ˜ë°œìœ ", 1966.40}, {"ë³´í†µíœ˜ë°œìœ ", 1746.84}, {"ìë™ì°¨ìš©ê²½ìœ ", 1663.32}, {"ì‹¤ë‚´ë“±ìœ ", 1333.73}}},
    {"251202", {{"ê³ ê¸‰íœ˜ë°œìœ ", 1965.94}, {"ë³´í†µíœ˜ë°œìœ ", 1746.74}, {"ìë™ì°¨ìš©ê²½ìœ ", 1662.98}, {"ì‹¤ë‚´ë“±ìœ ", 1334.27}}},
    {"251203", {{"ê³ ê¸‰íœ˜ë°œìœ ", 1965.92}, {"ë³´í†µíœ˜ë°œìœ ", 1746.78}, {"ìë™ì°¨ìš©ê²½ìœ ", 1662.72}, {"ì‹¤ë‚´ë“±ìœ ", 1334.83}}},
    {"251204", {{"ê³ ê¸‰íœ˜ë°œìœ ", 1965.54}, {"ë³´í†µíœ˜ë°œìœ ", 1746.76}, {"ìë™ì°¨ìš©ê²½ìœ ", 1662.58}, {"ì‹¤ë‚´ë“±ìœ ", 1334.91}}},
    {"251205", {{"ê³ ê¸‰íœ˜ë°œìœ ", 1965.42}, {"ë³´í†µíœ˜ë°œìœ ", 1746.70}, {"ìë™ì°¨ìš©ê²½ìœ ", 1662.34}, {"ì‹¤ë‚´ë“±ìœ ", 1335.60}}},
    {"251206", {{"ê³ ê¸‰íœ˜ë°œìœ ", 1964.14}, {"ë³´í†µíœ˜ë°œìœ ", 1746.35}, {"ìë™ì°¨ìš©ê²½ìœ ", 1661.60}, {"ì‹¤ë‚´ë“±ìœ ", 1335.41}}},
    {"251207", {{"ê³ ê¸‰íœ˜ë°œìœ ", 1964.35}, {"ë³´í†µíœ˜ë°œìœ ", 1746.35}, {"ìë™ì°¨ìš©ê²½ìœ ", 1661.36}, {"ì‹¤ë‚´ë“±ìœ ", 1335.66}}}
};

// ì£¼ìœ ì†Œë³„ í• ì¸ìœ¨ (100ë¶„ìœ¨ë¡œ ì €ì¥, ì˜ˆ: 10% í• ì¸ì€ 0.10) - ë¸Œëœë“œëŠ” í• ì¸ì—ë§Œ ì‚¬ìš©ë¨
map<string, double> gasStationDiscounts = {
    {"SK", 0.10},   // 10% í• ì¸
    {"GS", 0.05},   // 5% í• ì¸
    {"S-OIL", 0.15}, // 15% í• ì¸
    {"HD", 0.0},
    {"ì•Œëœ°", 0.0}
};

// ì£¼ìš” ì°¨ëŸ‰ ì •ë³´
map<string, CarInfo> presetCars = {
    {"ì•„ë°˜ë–¼", {"ì•„ë°˜ë–¼", 55.0, 18.0}}, {"ì†Œë‚˜íƒ€", {"ì†Œë‚˜íƒ€", 58.0, 17.0}}, {"ê·¸ëœì €", {"ê·¸ëœì €", 60.0, 16.0}}, 
    {"G80", {"G80", 65.0, 15.0}}, {"GV80", {"GV80", 75.0, 12.0}}, {"A4", {"A4", 62.0, 15.0}},
    {"A6", {"A6", 68.0, 16.0}}, {"eclass", {"E-Class", 65.0, 14.0}}, {"sclass", {"S-Class", 70.0, 10.0}},
    {"520", {"520", 68.0, 12.0}}, {"530", {"530", 70.0, 11.0}}
};

// ì „ì—­ ë³€ìˆ˜
double currentFuel = 0.0;
double lastPricePerLiter = 0.0;
string lastFuelType = "ì—†ìŒ";
string lastGasStation = "ì—†ìŒ";
string REFUEL_DATE = ""; // mainì—ì„œ ì…ë ¥ë°›ë„ë¡ ë³€ê²½

// ì£¼ìœ  í• ì¸ ë¹„ìš© ê³„ì‚° í•¨ìˆ˜
double calculateDiscountedCost(double totalCost, const string& gasStation) {
    double discountRate = 0.0;
    if (gasStationDiscounts.count(gasStation)) {
        discountRate = gasStationDiscounts.at(gasStation);
    }
    double discountedCost = totalCost * (1.0 - discountRate);
    return round(discountedCost); // ë°˜ì˜¬ë¦¼í•˜ì—¬ ì •ìˆ˜ ê¸ˆì•¡ìœ¼ë¡œ ê³„ì‚°
}

// ì´ˆê¸° ì£¼ìœ  í•¨ìˆ˜ (í•œ ì¤„ ì…ë ¥)
void initialRefuel(CarInfo& car) {
    string fuelType;
    string gasStation;
    double refuelLiters;

    // ìˆ˜ì •: ì…ë ¥ ì˜ˆì‹œ ì œê±°
    cout << "\n> ì´ˆê¸° ì£¼ìœ  ì •ë³´ (ìœ ì¢… ì£¼ìœ ì†Œ ë¦¬í„°): "; 
    if (!(cin >> fuelType >> gasStation >> refuelLiters)) {
        cout << "ì…ë ¥ ì˜¤ë¥˜ ë°œìƒ. ì´ˆê¸° ì£¼ìœ ë¥¼ ê±´ë„ˆëœë‹ˆë‹¤." << endl;
        return;
    }

    double price = 0.0;
    if (dailyFuelPrices.count(REFUEL_DATE) && dailyFuelPrices.at(REFUEL_DATE).count(fuelType)) {
        price = dailyFuelPrices.at(REFUEL_DATE).at(fuelType);
    } else {
        cout << "ê²½ê³ : ìœ íš¨í•˜ì§€ ì•Šì€ ë‚ ì§œ ë˜ëŠ” ìœ ì¢… ì •ë³´ì…ë‹ˆë‹¤. 251207 ë³´í†µíœ˜ë°œìœ (1746.35ì›)ë¡œ ì„¤ì •í•©ë‹ˆë‹¤." << endl;
        price = 1746.35;
        fuelType = "ë³´í†µíœ˜ë°œìœ ";
    }

    lastPricePerLiter = price;
    lastFuelType = fuelType;
    lastGasStation = gasStation;

    double totalCost = refuelLiters * price;
    double discountedCost = calculateDiscountedCost(totalCost, gasStation);
    double discountRate = gasStationDiscounts.count(gasStation) ? gasStationDiscounts.at(gasStation) : 0.0;

    cout << "\n" << REFUEL_DATE.substr(0, 2) << "ë…„ 12ì›” " << REFUEL_DATE.substr(4, 2) << "ì¼ [" << lastFuelType << "]ë¥¼ ë¦¬í„°ë‹¹ [" << lastPricePerLiter << "]ì›(ì¼ë³„ í‰ê·  ê°€ê²©)ì— ì£¼ìœ í•˜ì…¨êµ°ìš”." << endl;
    cout << refuelLiters << "ë¦¬í„° ì´ " << totalCost << "ì›, " << (discountRate * 100) << "% í• ì¸ í›„ **" << discountedCost << "**ì›ì„ ì£¼ìœ í•˜ì…¨ìŠµë‹ˆë‹¤." << endl;
    
    currentFuel = min(car.tankCapacity, refuelLiters);
    cout << "í˜„ì¬ ì”ì—¬ ì—°ë£ŒëŸ‰ì€ " << currentFuel << "ë¦¬í„°ì…ë‹ˆë‹¤." << endl;
}

// ì£¼í–‰ í•¨ìˆ˜ (í•œ ì¤„ ì…ë ¥)
char drive(CarInfo& car) {
    double drivenKm;
    char choice;

    // ìˆ˜ì •: ì…ë ¥ ì˜ˆì‹œ ì œê±°
    cout << "\n> ì£¼í–‰/ì¶”ê°€ ì£¼ìœ  ê²°ì • (km Y/N): "; 
    if (!(cin >> drivenKm >> choice)) {
        cout << "ì…ë ¥ ì˜¤ë¥˜ ë°œìƒ. ì‹œë®¬ë ˆì´ì…˜ì„ ì¢…ë£Œí•©ë‹ˆë‹¤." << endl;
        return 'N';
    }

    double litersUsed = drivenKm / car.fuelEfficiency;
    double newCurrentFuel = max(0.0, currentFuel - litersUsed);
    
    cout << "ê·¸ëŸ¼ ë¦¬í„°ë‹¹ " << car.fuelEfficiency << "km ì—°ë¹„ë¡œ " << drivenKm << "kmë¥¼ ì£¼í–‰í•˜ì…”ì„œ " << litersUsed << "ë¦¬í„°ë¥¼ ì‚¬ìš© í›„," << endl;
    cout << newCurrentFuel << "ë¦¬í„°ë§Œí¼ ë‚¨ì•„ìˆê² ë„¤ìš”." << endl;
    
    currentFuel = newCurrentFuel;
    return toupper(choice);
}

// ì¶”ê°€ ì£¼ìœ  í•¨ìˆ˜ (í•œ ì¤„ ì…ë ¥)
void additionalRefuel(CarInfo& car) {
    string fuelType;
    string amountStr; // 'ê°€ë“' ë˜ëŠ” ê¸ˆì•¡ ë¬¸ìì—´

    // ìˆ˜ì •: ì…ë ¥ ì˜ˆì‹œ ì œê±°
    cout << "\n> ì¶”ê°€ ì£¼ìœ  (ìœ ì¢… ê°€ë“/ê¸ˆì•¡): "; 
    if (!(cin >> fuelType >> amountStr)) {
        cout << "ì…ë ¥ ì˜¤ë¥˜ ë°œìƒ. ì¶”ê°€ ì£¼ìœ ë¥¼ ê±´ë„ˆëœë‹ˆë‹¤." << endl;
        return;
    }

    double price = 0.0;
    if (dailyFuelPrices.count(REFUEL_DATE) && dailyFuelPrices.at(REFUEL_DATE).count(fuelType)) {
        price = dailyFuelPrices.at(REFUEL_DATE).at(fuelType);
    } else {
        cout << "ê²½ê³ : ìœ ì¢… ì •ë³´ê°€ ìœ íš¨í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. ë³´í†µíœ˜ë°œìœ  ê°€ê²©ìœ¼ë¡œ ì„¤ì •í•©ë‹ˆë‹¤." << endl;
        if (dailyFuelPrices.count(REFUEL_DATE) && dailyFuelPrices.at(REFUEL_DATE).count("ë³´í†µíœ˜ë°œìœ ")) {
            price = dailyFuelPrices.at(REFUEL_DATE).at("ë³´í†µíœ˜ë°œìœ ");
            fuelType = "ë³´í†µíœ˜ë°œìœ ";
        } else {
            cout << "ì¹˜ëª…ì  ì˜¤ë¥˜: ë‚ ì§œ ë˜ëŠ” ìœ ì¢… ê°€ê²©ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ì£¼ìœ ë¥¼ ê±´ë„ˆëœë‹ˆë‹¤." << endl;
            return;
        }
    }
    
    lastPricePerLiter = price;
    lastFuelType = fuelType;

    double refuelAmount = 0.0;
    double discountRate = gasStationDiscounts.count(lastGasStation) ? gasStationDiscounts.at(lastGasStation) : 0.0;

    if (amountStr == "ê°€ë“") {
        double neededLiters = car.tankCapacity - currentFuel;
        refuelAmount = neededLiters;
        double totalCost = refuelAmount * price;
        double discountedCost = calculateDiscountedCost(totalCost, lastGasStation);

        // ìˆ˜ì •: ì¶œë ¥ ë©”ì‹œì§€ì— ì‹¤ì œ ì…ë ¥ëœ ìœ ì¢… ë°˜ì˜
        cout << "[" << fuelType << " ê°€ë“]-> ìœ ë¥˜íƒ±í¬ ì´ ìš©ëŸ‰ " << car.tankCapacity << "L ì¤‘ " << currentFuel << "L ë§Œí¼ ë‚¨ì•„ìˆì–´ " << refuelAmount << "L ë§Œí¼ ì£¼ìœ í•˜ê² ìŠµë‹ˆë‹¤." << endl;
        cout << "ì´ ê¸ˆì•¡ì€ " << totalCost << "ì›, " << (discountRate * 100) << "% í• ì¸ í›„ **" << discountedCost << "**ì›ì…ë‹ˆë‹¤." << endl;
        currentFuel = car.tankCapacity;
    } else {
        // ê¸ˆì•¡ìœ¼ë¡œ ì£¼ìœ 
        try {
            double money = stod(amountStr);
            
            double discountedPricePerLiter = price * (1.0 - discountRate);
            double liters = money / discountedPricePerLiter;
            
            double maxLiters = car.tankCapacity - currentFuel;
            if (liters > maxLiters) {
                refuelAmount = maxLiters;
                double actualCost = refuelAmount * discountedPricePerLiter; 
                cout << "ì£¼ì˜: [" << money << "]ì›ìœ¼ë¡œëŠ” " << liters << "L ì£¼ìœ  ê°€ëŠ¥í•˜ì§€ë§Œ, íƒ±í¬ ìš©ëŸ‰ ì´ˆê³¼ë¡œ **" << actualCost << "**ì›, " << refuelAmount << "Lë§Œ ì£¼ìœ ë©ë‹ˆë‹¤." << endl;
            } else {
                refuelAmount = liters;
                cout << "[" << money << "]ì› (" << (discountRate * 100) << "% í• ì¸ ì ìš© í›„) ë§Œí¼ ì£¼ìœ í•˜ê² ìŠµë‹ˆë‹¤. [" << REFUEL_DATE << "]ê¸°ì¤€ " << lastFuelType << " í‰ê·  ê°€ê²© " << lastPricePerLiter << "ì›ìœ¼ë¡œ " << refuelAmount << "ë¦¬í„°ë§Œí¼ ì£¼ìœ ë©ë‹ˆë‹¤." << endl;
            }
            
            currentFuel += refuelAmount;

        } catch (const std::invalid_argument& e) {
            cout << "ê²½ê³ : ì˜ëª»ëœ ì…ë ¥ ê°’ì…ë‹ˆë‹¤. ì£¼ìœ ë¥¼ ê±´ë„ˆëœë‹ˆë‹¤." << endl;
            return;
        }
    }

    cout << "ì¶”ê°€ ì£¼ìœ  í›„ í˜„ì¬ ì”ì—¬ ì—°ë£ŒëŸ‰ì€ " << currentFuel << "ë¦¬í„°ì…ë‹ˆë‹¤." << endl;
}

int main() {
    cout << fixed << setprecision(2);
    string carNameInput;
    CarInfo currentCar;

    cout << "ğŸš˜ ì£¼ìœ  ë° ì—°ë¹„ ì‹œë®¬ë ˆì´ì…˜ ì‹œìŠ¤í…œ ì‹œì‘" << endl;
    
    // ì£¼ìœ ì¼ ì…ë ¥ ë°›ê¸°
    // ìˆ˜ì •: ì…ë ¥ ì˜ˆì‹œ ì œê±°
    cout << "> ì£¼ìœ  ê¸°ì¤€ ë‚ ì§œë¥¼ ì…ë ¥í•´ ì£¼ì„¸ìš” (YYMMDD í˜•ì‹): "; 
    cin >> REFUEL_DATE;
    
    // ìˆ˜ì •: ì…ë ¥ ì˜ˆì‹œ ì œê±°
    cout << "> ë‹¹ì‹ ì˜ ì°¨ëŠ” ë¬´ì—‡ì…ë‹ˆê¹Œ?: "; 
    cin >> carNameInput;

    auto it = presetCars.find(carNameInput);
    if (it != presetCars.end()) {
        currentCar = it->second;
    } else {
        cout << "í”„ë¦¬ì…‹ì— ì—†ëŠ” ì°¨ëŸ‰ì…ë‹ˆë‹¤. 'ì•„ë°˜ë–¼' (55.0L, 18.0km/L) ì •ë³´ë¡œ ì§„í–‰í•©ë‹ˆë‹¤." << endl;
        currentCar = presetCars["ì•„ë°˜ë–¼"];
    }

    cout << "->[" << currentCar.name << "]ì´êµ°ìš”. ìœ ë¥˜íƒ±í¬ ìš©ëŸ‰ì€ " << currentCar.tankCapacity << "ë¦¬í„°ì…ë‹ˆë‹¤." << endl;

    // 1. ì´ˆê¸° ì£¼ìœ 
    initialRefuel(currentCar);

    char choice;
    do {
        // 2. ì£¼í–‰ ë° ì¶”ê°€ ì£¼ìœ  ê²°ì •
        choice = drive(currentCar);
        
        if (choice == 'Y') {
            // 3. ì¶”ê°€ ì£¼ìœ 
            additionalRefuel(currentCar);
        }
    } while (choice == 'Y');

    cout << "\n--- ì‹œìŠ¤í…œ ìœ ì§€ ---" << endl;
    cout << "ìµœì¢… ì”ì—¬ ì—°ë£ŒëŸ‰ì€ " << currentFuel << "ë¦¬í„°ì…ë‹ˆë‹¤." << endl;
    cout << "ì‹œë®¬ë ˆì´ì…˜ì„ ì¢…ë£Œí•©ë‹ˆë‹¤." << endl;

    return 0;
}
